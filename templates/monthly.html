{% extends "base.html" %}

{% block page_title %}{{ title }} - 月报{% endblock %}
{% block accent_color %}#5B2C6F{% endblock %}
{% block title_color %}#5B2C6F{% endblock %}

{% block extra_styles %}
.overview-section {
    background: #f5f0fa;
    border-left: 4px solid #5B2C6F;
    padding: 15px 20px;
    margin: 20px 0;
}
.overview-title { color: #5B2C6F; font-size: 16px; font-weight: bold; margin-bottom: 10px; }
.overview-text { font-size: 14px; line-height: 1.8; }
.stats-section {
    margin: 20px 0; padding: 15px;
    background: #fafafa; border: 1px solid #eee;
}
.stats-title { color: #5B2C6F; font-size: 15px; margin-bottom: 10px; }
.stats-table { width: 100%; border-collapse: collapse; font-size: 14px; }
.stats-table th, .stats-table td {
    padding: 6px 12px; text-align: left; border-bottom: 1px solid #eee;
}
.stats-table th { background: #f0f0f0; color: #555; }
.section-divider { border-top: 2px solid #5B2C6F; }
.category-title { color: #5B2C6F; }
.footer-section { border-top: 2px solid #5B2C6F; }
{% endblock %}

{% block content %}
<h1 class="report-title">{{ title }} · 月报</h1>
<p class="report-subtitle">AI MONTHLY INTELLIGENCE BRIEF</p>
<div class="report-meta">
    {{ year }}年{{ month_name }} &nbsp;|&nbsp; 月度综合分析
</div>

{% if overview %}
<div class="overview-section">
    <div class="overview-title">【月度综述】</div>
    <p class="overview-text">{{ overview }}</p>
</div>
{% endif %}

{% if category_stats %}
<div class="stats-section">
    <h3 class="stats-title">本月动态分类统计</h3>
    <table class="stats-table">
        <tr><th>分类</th><th>数量</th></tr>
        {% for cat, count in category_stats %}
        <tr><td>{{ cat }}</td><td>{{ count }}</td></tr>
        {% endfor %}
        <tr style="background:#f5f5f5"><td><b>合计</b></td><td><b>{{ article_count }}</b></td></tr>
    </table>
</div>
{% endif %}

<div class="section-divider"></div>

{% set nums = ["一","二","三","四","五","六","七","八","九","十"] %}
{% set ns = namespace(section=0) %}
{% for cat in category_order %}
    {% if cat in categories %}
    {% set ns.section = ns.section + 1 %}
    <div class="category-section">
        <h2 class="category-title">{{ nums[ns.section - 1] if ns.section <= 10 else ns.section }}、{{ cat }}</h2>
        <div class="category-divider"></div>
        {% for art in categories[cat] %}
        <div class="article-item">
            <div class="article-header">
                <span class="importance">{{ "★" * art.importance_score }}</span>
                <span class="article-title">{{ art.title_zh }}</span>
            </div>
            <p class="article-summary">{{ art.summary_zh }}</p>
            <div class="article-meta">来源：{{ art.source_name }}</div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
{% endfor %}

<div class="footer-section">
    <p class="footer-text">本月共汇集{{ article_count }}条动态。</p>
</div>
{% endblock %}
